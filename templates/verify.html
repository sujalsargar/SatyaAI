{% extends "base.html" %}
{% block content %}

<section class="verify-section">

  <div class="verify-card">

    <h2 class="verify-title">Verification Dashboard</h2>
    <p class="verify-sub">
      Submit text, URL, image, audio, or video â€” TruthMate will analyze, verify, and detect misinformation.
    </p>

    <!-- Mode Tabs -->
    <div class="verify-tabs" role="tablist">
      <button data-type="text" class="vtab active">ğŸ“ Text</button>
      <button data-type="url" class="vtab">ğŸ”— URL</button>
      <button data-type="image" class="vtab">ğŸ–¼ Image</button>
      <button data-type="video" class="vtab">ğŸ¥ Video</button>
      <button data-type="audio" class="vtab">ğŸ¤ Audio</button>
    </div>

    <!-- Verification Form -->
    <form id="analyze-form" action="{{ url_for('analyze') }}" method="post" enctype="multipart/form-data">
      <input type="hidden" name="type" id="input-type" value="text" />

      <!-- TEXT -->
      <div id="text-box" class="input-wrapper fade-in">
        <textarea
          name="text"
          class="verify-textarea"
          placeholder="Paste claim, message, article, or social media content..."
        ></textarea>
      </div>

      <!-- URL -->
      <div id="url-box" class="input-wrapper hidden">
        <input
          type="url"
          name="url"
          class="verify-input"
          placeholder="Paste a website, news article, tweet, or YouTube link..."
        />
      </div>

      <!-- FILE UPLOAD -->
      <div id="file-box" class="input-wrapper hidden file-upload">
        <label class="file-label">Upload media file</label>

        <!-- Hidden input -->
        <input
          type="file"
          name="file"
          id="file-input"
          class="verify-file-input"
          accept="image/*,video/*,audio/*"
        />

        <!-- Custom Button -->
        <label for="file-input" class="file-picker-btn">ğŸ“ Choose File</label>

        <!-- File Name -->
        <span id="file-name" class="file-name">No file selected</span>
      </div>

      <button class="btn-verify verify-btn" type="submit">
        âœ… Verify Now
      </button>
    </form>

    <!-- Bottom Links -->
    <div class="verify-actions">
      <a href="{{ url_for('history') }}" class="btn-outline small">ğŸ“‚ View history</a>
      <a href="{{ url_for('privacy') }}" class="btn-outline small">ğŸ”’ Privacy</a>
    </div>

  </div>
</section>

<script>
(function () {
  const tabs = document.querySelectorAll(".vtab");
  const inputType = document.getElementById("input-type");

  const textBox = document.getElementById("text-box");
  const urlBox = document.getElementById("url-box");
  const fileBox = document.getElementById("file-box");
  const fileInput = document.getElementById("file-input");
  const fileName = document.getElementById("file-name");

  const wrappers = [textBox, urlBox, fileBox];

  function switchMode(btn) {
    tabs.forEach(t => t.classList.remove("active"));
    btn.classList.add("active");

    const selected = btn.dataset.type;
    inputType.value = selected;

    // Hide all with animation reset
    wrappers.forEach(el => {
      el.classList.add("hidden");
      el.classList.remove("fade-in");
    });

    // Show selected + animate
    let target;
    if (selected === "text") target = textBox;
    else if (selected === "url") target = urlBox;
    else target = fileBox;

    // Set accepted file types dynamically
    if (selected === "image") fileInput.accept = "image/*";
    if (selected === "video") fileInput.accept = "video/*";
    if (selected === "audio") fileInput.accept = "audio/*";

    setTimeout(() => {
      target.classList.remove("hidden");
      target.classList.add("fade-in");
    }, 120);
  }

  tabs.forEach(btn =>
    btn.addEventListener("click", () => switchMode(btn))
  );

  // Display selected filename
  if (fileInput) {
    fileInput.addEventListener("change", () => {
      fileName.textContent =
        fileInput.files.length ? fileInput.files[0].name : "No file selected";
    });
  }
})();
</script>

{% endblock %}
